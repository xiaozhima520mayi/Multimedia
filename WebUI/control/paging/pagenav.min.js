/*
*调用示例   20150914 lq 替换掉pagenav1.2.min.js
*        
$(function () {
$("#pageNav").pager({ pagenumber: 1, pagecount: 1, buttonPageCallback: buttonPageClick });
});
buttonPageClick = function (e) {
$("#pageNav").pager({ pagenumber: parseInt(e), pagecount: 1, buttonPageCallback: buttonPageClick });
}
*
*/
(function ($) {
    $.fn.pager = function (options) {
        var pagenumber = parseInt(options.pagenumber);
        var pagecount = parseInt(options.pagecount);
        if (pagecount <= 1) {
            $(this).html("");
            return;
        }
        var startPoint = 1;
        var endPoint = 5;

        if (pagenumber > 4) {
            startPoint = pagenumber - 2;
            endPoint = pagenumber + 2;
        }

        if (endPoint > pagecount) {
            startPoint = pagecount - 4;
            endPoint = pagecount;
        }

        if (startPoint < 1) {
            startPoint = 1;
        }
        $(this).html("");
        var $first = createButton("first", pagenumber, pagecount, options.buttonPageCallback);
        var $prev = createButton("prev", pagenumber, pagecount, options.buttonPageCallback);
        $(this).append($first);
        $(this).append($prev);
        for (var page = startPoint; page <= endPoint; page++) {
            var $currentpage = $(" <a href=\"javascript://\">" + page + "</a> ");
            if (page == pagenumber) {
                $currentpage = $(" <a href=\"javascript://\" class='e'>" + page + "</a> ");
            }
            $currentpage.click(function () {
                options.buttonPageCallback(this.firstChild.data);
            });
            $(this).append($currentpage);
        }
        var $next = createButton("next", pagenumber, pagecount, options.buttonPageCallback);
        var $last = createButton("last", pagenumber, pagecount, options.buttonPageCallback);
        $(this).append($next);
        $(this).append($last);
    }
    function createButton(btn, pagenumber, pagecount, buttonPageCallback) {
        var page = 0;
        var btnLabel = "";
        var btnClass = "pre";
        var p = pagenumber;
        switch (btn) {
            case "prev": page = pagenumber - 1; btnLabel = "上一页"; btnClass = "pre"; break;
            case "next": page = pagenumber + 1; btnLabel = "下一页"; btnClass = "last"; break;
            case "first": btnLabel = "首页"; break;
            case "last": btnLabel = "尾页"; break;
        }
        var $button = $(" <a class='" + btnClass + "' href=\"javascript://\" title='" + btnLabel + "'>" + btnLabel + "</a> ");
        if (btn == "prev") {
            p <= 1 ? $button.addClass("d").css("cursor", "default") : $button.click(function () {
                buttonPageCallback(page);
            });
        }
        else if (btn == "next") {
            p >= pagecount ? $button.addClass("d").css("cursor", "default") : $button.click(function () {
                buttonPageCallback(page);
            });
        } else if (btn == "first") {
            p <= 1 ? $button.addClass("d").css("cursor", "default") : $button.click(function () {
                buttonPageCallback(1);
            });;

        } else if (btn == "last") {
            p >= pagecount ? $button.addClass("d").css("cursor", "default") : $button.click(function () {
                buttonPageCallback(pagecount);
            });

        } else {
            p == pagecount ? $button.addClass("d").css("cursor", "default") : $button.click(function () {
                buttonPageCallback(pagecount);
            });
        }
        return $button;
    }
    $.fn.pager.defaults = {
        pagenumber: 1,
        pagecount: 1
    };

    $.fn.pager2 = function (options) {
        //pageNumCount 为显示多少条页码数
        //pageForward  为每次加载页码数
        var setting = { pagenumber: 0, pagecount: 0, prev: "<<", next: ">>", pageNumCount: 5, pageForward: 2 };
        setting = $.extend(setting, options);
        var a = parseInt(setting.pagenumber);
        var b = parseInt(setting.pagecount);
        if (1 >= b) {
            return this.pn = this.p = 1, pHtml2(1, b);
        }
        b < a && (a = b); var c = "";
        1 >= a ? a = 1 : (c += createButton2(a - 1, b, setting.prev, options.buttonPageCallback), c += createButton2(1, b, "", options.buttonPageCallback));
        this.p = a;
        this.pn = b;
        //A.
        var d = 2, e = setting.pageNumCount > b ? b : setting.pageNumCount;
        //B.
        5 <= a && (c += "<span>...</span>", d = a - setting.pageForward, e = a + setting.pageForward, e = b < e ? b : e);
        for (; d < a; d++) c += createButton2(d, b, "", options.buttonPageCallback);
        c += pHtml2(a, b);
        for (d = a + 1; d <= e; d++)
            c += createButton2(d, b, "", options.buttonPageCallback);
        e < b && (c = c + "<span>...</span>" + createButton2(b, b, "", options.buttonPageCallback));
        a < b && (c += createButton2(a + 1, b, setting.next, options.buttonPageCallback));
        $(this).html(c);
        $(this).find("a").click(function () {
            if ($(this).attr("page") != null)
                setting.buttonPageCallback($(this).attr("page"));
        });
    }
    pHtml2 = function (a, b) { return (b == 1 || b == 0) ? "" : " <a class='e'>" + a + "</a> "; }
    function createButton2(pagenumber, pagecount, btn, buttonPageCallback) {
        var className = "";
        if (btn != "") className = btn == "上一页" ? "last" : "next";
        btn = btn == "" ? pagenumber : btn;
        return " <a href=\"javascript://\" page='" + pagenumber + "' class='" + className + "'>" + (btn) + "</a> ";
    }
}(jQuery));
